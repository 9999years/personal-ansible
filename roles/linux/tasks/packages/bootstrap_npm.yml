---
- name: Check for npm
  stat:
      path: '{{ npm_bin }}'
  register: npm_stat
  changed_when: not (npm_stat.stat.exists and npm_stat.stat.executable)

- name: Install npm
  when: npm_stat is changed
  become: true
  block:
      - name: Download npm archive
        unarchive:
            remote_src: true
            src: '{{ npm_url }}'
            dest: /usr/local
            extra_opts:
                - --strip-components=1
