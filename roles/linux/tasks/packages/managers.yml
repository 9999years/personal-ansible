---
- name: Install apt packages
  become: true
  loop: '{{ apt_packages }}'
  apt:
      package: '{{ item }}'

- name: Install Linuxbrew packages
  become: true
  become_user: '{{ ansible_hostname }}'
  loop: '{{ homebrew_packages }}'
  vars:
          # Spurious error
          # https://github.com/microsoft/WSL/issues/1838
          nice_warning: 'nice: cannot set niceness: Permission denied'
  homebrew:
      state: latest
      package: '{{ item }}'
      path: '{{ homebrew_bin }}'
  register: brew_install
  failed_when: brew_install is failed
          and (brew_install.msg|replace(nice_warning, '')).strip() != ''

- name: Link Linuxbrew binaries to /usr/local/bin
  loop: '{{ homebrew_links }}'
  become: true
  file:
      state: link
      src: '{{ homebrew_bin_dir }}/{{ item }}'
      path: '/usr/local/bin/{{ item }}'
      mode: 0755

- name: Install pip packages
  become: true
  pip:
      executable: '{{ homebrew_bin_dir }}/pip3'
      name: '{{ pip_packages }}'
      state: latest

- name: Install Ruby Gems
  become: true
  loop: '{{ ruby_gems }}'
  gem:
      name: '{{ item }}'
      state: latest
      user_install: false

- name: Install Node packages
  become: true
  loop: '{{ npm_packages }}'
  npm:
      global: true
      name: '{{ item }}'

- name: Install Vim plugins
  become: true
  become_user: '{{ ansible_hostname }}'
  shell: "yes '\n' | vim +PlugInstall +qall!"
