---
- name: Check for rust-analyzer
  register: rust_analyzer_stat
  stat:
      path: {{ cargo_bin_dir }}/ra_lsp_server
  changed_when: not rust_analyzer_stat.stat.exists

- name: Build rust-analyzer
  when: rust_analyzer_stat is changed
  block:
      - name: Create temporary directory
        register: tmpdir
        tempfile:
            state: directory

      - name: Clone repository
        git:
            repo: https://github.com/rust-analyzer/rust-analyzer
            dest: '{{ tmpdir.path }}'

      - name: Build hexd
        command: cargo install-ra --server
        args:
            chdir: '{{ tmpdir.path }}'
